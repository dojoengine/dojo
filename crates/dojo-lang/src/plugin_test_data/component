//! > Test expansion of the component contract.

//! > test_runner_name
ExpandContractTestRunner

//! > cairo_code
use serde::Serde;

#[derive(Component)]
struct Position {
    x: felt252,
    y: felt252
}

trait PositionTrait {
    fn is_zero(self: Position) -> bool;
    fn is_equal(self: Position, b: Position) -> bool;
}

impl PositionImpl of PositionTrait {
    fn is_zero(self: Position) -> bool {
        match self.x - self.y {
            0 => bool::True(()),
            _ => bool::False(()),
        }
    }

    fn is_equal(self: Position, b: Position) -> bool {
        self.x == b.x & self.y == b.y
    }
}

//! > generated_cairo_code
use serde::Serde;

trait PositionTrait {
    fn is_zero(self: Position) -> bool;
    fn is_equal(self: Position, b: Position) -> bool;
}

impl PositionImpl of PositionTrait {
    fn is_zero(self: Position) -> bool {
        match self.x - self.y {
            0 => bool::True(()),
            _ => bool::False(()),
        }
    }

    fn is_equal(self: Position, b: Position) -> bool {
        self.x == b.x & self.y == b.y
    }
}

#[derive(Copy, Drop)]
struct Position {
    x: felt252,
    y: felt252
}

#[abi]
trait IPosition {
    fn name() -> felt252;
    fn len() -> u8;
    fn serialize(raw: Span<felt252>) -> Position;
    fn deserialize(value: Position) -> Span<felt252>;
}

impl PositionSerde of serde::Serde::<Position> {
    fn serialize(ref serialized: Array::<felt252>, input: Position) {
        serde::Serde::<felt252>::serialize(ref serialized, input.x);
        serde::Serde::<felt252>::serialize(ref serialized, input.y);
    }
    fn deserialize(ref serialized: Span::<felt252>) -> Option::<Position> {
        Option::Some(
            Position {
                x: serde::Serde::<felt252>::deserialize(ref serialized)?,
                y: serde::Serde::<felt252>::deserialize(ref serialized)?,
            }
        )
    }
}

#[contract]
mod PositionComponent {
    use array::ArrayTrait;
    use option::OptionTrait;
    use dojo_core::serde::SpanSerde;
    use super::Position;

    #[view]
    fn name() -> felt252 {
        'Position'
    }

    #[view]
    fn len() -> usize {
        2_usize
    }
}

//! > expected_diagnostics
